$signature = @"
[DllImport("netapi32.dll", SetLastError=true)]
public static extern int NetShareEnum(
    string servername,
    int level,
    out IntPtr bufPtr,
    int prefmaxlen,
    out int entriesread,
    out int totalentries,
    out int resume_handle
);
"@

# Add the PInvoke signature to the PowerShell session
Add-Type -MemberDefinition $signature -Namespace Win32 -Name NetApi32

# Call the NetShareEnum function to list local shares
$bufPtr = [IntPtr]::Zero
$entriesread = 0
$totalentries = 0
$resume_handle = 0
$result = [Win32.NetApi32]::NetShareEnum($env:COMPUTERNAME, 1, [ref]$bufPtr, -1, [ref]$entriesread, [ref]$totalentries, [ref]$resume_handle)

# Check if the call to NetShareEnum succeeded
if ($result -eq 0) {
    # Convert the pointer to a structure array and iterate over the shares
    $shareInfo = [System.Runtime.InteropServices.Marshal]::PtrToStructure($bufPtr, [Type][Win32.SHARE_INFO_1])
    for ($i = 0; $i -lt $entriesread; $i++) {
        Write-Host $shareInfo[$i].shi1_netname
    }

    # Free the memory allocated by NetShareEnum
    [Win32.NetApi32]::NetApiBufferFree($bufPtr)
}
else {
    Write-Error "NetShareEnum failed with error code $result"
}
